!function(e){var t={};function r(s){if(t[s])return t[s].exports;var n=t[s]={i:s,l:!1,exports:{}};return e[s].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(s,n,function(t){return e[t]}.bind(null,n));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=1)}([function(e,t,r){},function(e,t,r){"use strict";r.r(t);r(0);class s{constructor(e,t){this._form=t,this._inputSelector=e.inputSelector,this._submitButtonSelector=e.submitButtonSelector,this._inactiveButtonClass=e.inactiveButtonClass,this._inputErrorClass=e.inputErrorClass,this._errorClass=e.errorClass,this._openFormBtn=e.formButton}_showInputError(e,t,r){e.classList.add(this._inputErrorClass),t.classList.add(this._errorClass),t.textContent=r}_hideInputError(e,t){e.classList.remove(this._inputErrorClass),t.classList.remove(this._errorClass),t.textContent=""}_isValid(e){const t=this._form.querySelector(`#${e.id}-error`);e.validity.valid?this._hideInputError(e,t):this._showInputError(e,t,e.validationMessage)}_hasInvalidInput(e){return e.some(e=>!e.validity.valid)}_toggleButtonState(e,t){this._hasInvalidInput(e)?(t.classList.add(this._inactiveButtonClass),t.setAttribute("disabled","")):(t.classList.remove(this._inactiveButtonClass),t.removeAttribute("disabled"))}_resetForm(e){e.forEach(e=>{const t=this._form.querySelector(`#${e.id}-error`);this._hideInputError(e,t)})}_setEventListeners(){const e=Array.from(this._form.querySelectorAll(this._inputSelector)),t=this._form.querySelector(this._submitButtonSelector),r=document.querySelectorAll(this._openFormBtn);this._toggleButtonState(e,t),e.forEach(r=>{r.addEventListener("input",()=>{this._isValid(r),this._toggleButtonState(e,t)})}),r.forEach(r=>{r.addEventListener("click",()=>{this._resetForm(e),this._toggleButtonState(e,t)})})}enableValidation(){this._form.addEventListener("submit",e=>{e.preventDefault()}),this._setEventListeners()}}class n{constructor({name:e,link:t,owner:r},s,{handleCardClick:n,handleLikeClick:i,handleDeleteIconClick:o}){this._cardSelector=s,this._cardName=e,this._cardLinkImage=t,this.handleCardClick=n,this.handleLikeClick=i,this.handleDeleteIconClick=o,this._ownerId=r._id,this._liked=!1,this._likeBtn=""}_getTemplate(){return document.querySelector(this._cardSelector).content.querySelector(".item").cloneNode(!0)}_isOwner(e){return e===this._ownerId}_renderDeleteIcon(e){if(this._isOwner(e)){this._cardItem.querySelector(".item__delete").classList.remove("item__delete_none")}}generate(e){return this._cardItem=this._getTemplate(),this._cardItem.querySelector(".item__image").src=this._cardLinkImage,this._cardItem.querySelector(".item__text").textContent=this._cardName,this._renderDeleteIcon(e),this._setEventListeners(),this._cardItem}_like(e){e.classList.add("item__like-icon_active")}_unlike(e){e.classList.remove("item__like-icon_active")}delete(){this._cardItem.remove(),this._cardItem=null}_isUserLiked(e,t){return e.likes.some(e=>e._id===t)}renderLikes(e,t,r,s,n){const i=t.querySelector(r);this._isUserLiked(e,n)||this._liked?!this._isUserLiked(e,n)||this._liked||s?this._liked&&s&&(i.textContent=e.likes.length,this._unlike(this._likeBtn)):(i.textContent=e.likes.length,this._like(this._likeBtn)):i.textContent=e.likes.length}isLiked(){return this._likeBtn.classList.contains("item__like-icon_active")?(this._liked=!0,!0):(this._liked=!1,!1)}_setEventListeners(){this._cardItem.querySelector(".item__delete").addEventListener("click",()=>{this.handleDeleteIconClick()}),this._likeBtn=this._cardItem.querySelector(".item__like-icon"),this._likeBtn.addEventListener("click",()=>{this.handleLikeClick()}),this._cardItem.querySelector(".item__image").addEventListener("click",e=>{this.handleCardClick(this._cardName,this._cardLinkImage)})}}class i{constructor({items:e,renderer:t},r){this._renderedItems=e,this._renderer=t,this._container=document.querySelector(r)}addItem(e,t){t?this._container.append(e):this._container.prepend(e)}renderItems(){this._renderedItems.forEach(e=>{this._renderer(e)})}}const o={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__submit",inactiveButtonClass:"popup__submit_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__form-error_visible",formButton:".form-button"},l=document.querySelector(".profile"),a=l.querySelector(".profile__info-edit-button"),c=l.querySelector(".profile__add-button");class u{constructor(e){this._popup=document.querySelector(e),this._handleEscClose=this._handleEscClose.bind(this)}_handleEscClose(e){"Escape"===e.key&&this.close()}setEventListeners(){this._popup.querySelector(".popup__close").addEventListener("click",()=>{this.close()}),this._popup.addEventListener("click",e=>{e.target===e.currentTarget&&this.close()})}open(){this._popup.classList.add("popup_opened"),addEventListener("keydown",this._handleEscClose)}close(){removeEventListener("keydown",this._handleEscClose),this._popup.classList.remove("popup_opened")}}class d extends u{constructor({formSubmitHandler:e},t){super(t),this._popup=document.querySelector(t),this._formSubmitHandler=e,this._popupForm=this._popup.querySelector(".popup__form")}_getInputValues(){const e={};return this._popup.querySelectorAll(".popup__input").forEach(t=>{e[t.name]=t.value}),e}renderLoading(e){const t=this._popupForm.querySelector(".popup__submit");t.textContent=e?"Сохранение...":"Сохранить"}setEventListeners(){this._popupForm.addEventListener("submit",e=>{e.preventDefault(),this._formSubmitHandler(this._getInputValues())}),super.setEventListeners()}close(){this._popupForm.reset(),super.close()}}class h extends u{constructor({formSubmitHandler:e},t){super(t),this._popup=document.querySelector(t),this._formSubmitHandler=e,this._popupForm=this._popup.querySelector(".popup__form")}confirmAction(e){return"submit"===e.type}setEventListeners(){this._popupForm.addEventListener("submit",e=>{e.preventDefault(),this._formSubmitHandler(e)}),super.setEventListeners()}}class _{constructor({userNameSelector:e,userInfoSelector:t,userAvatarSelector:r}){this._userNameElement=document.querySelector(e),this._userInfoElement=document.querySelector(t),this._userAvatarElement=document.querySelector(r)}getUserInfo(){const e={};return e.name=this._userNameElement.textContent,e.description=this._userInfoElement.textContent,e}setAvatar(e){this._userAvatarElement.style.backgroundImage=`url(${e.avatar})`}setUserInfo(e){this._userNameElement.textContent=e.name,this._userInfoElement.textContent=e.about}}const p=new _({userNameSelector:".profile__info-title",userInfoSelector:".profile__info-subtitle"}),m=new class extends u{constructor(e,t,r){super(e),this._popup=document.querySelector(e),this._placeImageName=this._popup.querySelector(t),this._placeImageUrl=this._popup.querySelector(r)}open(e,t){super.open(),this._placeImageName.textContent=e,this._placeImageUrl.src=t}}(".popup-image",".popup__place-name",".popup__image"),f=new _({userNameSelector:".profile__info-title",userInfoSelector:".profile__info-subtitle",userAvatarSelector:".profile__avatar"}),v=document.querySelector(".profile__avatar");let S="";const k=new class{constructor(e){this._url=e.baseUrl,this._headers=e.headers}_handleResponse(e){return e.ok?e.json():Promise.reject("Ошибка: "+e.status)}getInitialCards(){return fetch(this._url+"/cards",{method:"GET",headers:this._headers}).then(this._handleResponse)}addCard(e){return fetch(this._url+"/cards",{method:"POST",headers:this._headers,body:JSON.stringify(e)}).then(this._handleResponse)}deleteCard(e){return fetch(`${this._url}/cards/${e._id}`,{method:"DELETE",headers:this._headers}).then(this._handleResponse)}changeAvatar(e){return fetch(this._url+"/users/me/avatar",{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._handleResponse)}getUserInfo(){return fetch(this._url+"/users/me",{method:"GET",headers:this._headers}).then(this._handleResponse)}editUserInfo(e){return fetch(this._url+"/users/me",{method:"PATCH",headers:this._headers,body:JSON.stringify(e)}).then(this._handleResponse)}likeCard(e){return fetch(`${this._url}/cards/likes/${e._id}`,{method:"PUT",headers:this._headers}).then(this._handleResponse)}unLikeCard(e){return fetch(`${this._url}/cards/likes/${e._id}`,{method:"DELETE",headers:this._headers}).then(this._handleResponse)}}({baseUrl:"https://mesto.nomoreparties.co/v1/cohort-16",headers:{authorization:"075722c7-326f-4e9c-9498-630fe730cec9","Content-Type":"application/json"}});function y(e){const t=new d({formSubmitHandler:()=>{}},e);t.open(),t.setEventListeners()}function L(e){const t=document.querySelector(e).querySelector(o.formSelector);new s(o,t).enableValidation()}function E(e,t,r){const s=new i({items:e,renderer:e=>{s.addItem(function(e){const t=new n(e,".itemTemplate",{handleCardClick:(e,t)=>{m.open(e,t),m.setEventListeners()},handleDeleteIconClick:()=>{const r=new h({formSubmitHandler:s=>{r.confirmAction(s)&&k.deleteCard(e).then(()=>{t.delete()}).then(()=>{r.close()}).catch(e=>console.log(e))}},".popup-confirm");r.open(),r.setEventListeners()},handleLikeClick:()=>{t.isLiked()?k.unLikeCard(e).then(e=>{t.renderLikes(e,r,".item__like-counter",!0,S)}).catch(e=>console.log(e)):k.likeCard(e).then(e=>{t.renderLikes(e,r,".item__like-counter",!1,S)}).catch(e=>console.log(e))}}),r=t.generate(S);return t.renderLikes(e,r,".item__like-counter",!1,S),r}(e),r)}},t);s.renderItems()}Promise.all([k.getUserInfo(),k.getInitialCards()]).then(e=>{const[t,r]=e;f.setUserInfo(t),f.setAvatar(t),S=t._id,E(r,".gallery__items",!0)}).catch(e=>console.log(e));const g=new d({formSubmitHandler:e=>{g.renderLoading(!0),k.addCard({name:e.name,link:e.link}).then(e=>{E([e],".gallery__items",!1)}).then(()=>{g.close()}).catch(e=>console.log(e)).finally(()=>{g.renderLoading(!1)})}},".popup-add"),C=new d({formSubmitHandler:e=>{C.renderLoading(!0),k.editUserInfo({name:e.userName,about:e.userDescription}).then(e=>{f.setUserInfo(e)}).then(()=>{C.close()}).catch(e=>console.log(e)).finally(()=>{C.renderLoading(!1)})}},".popup-edit"),I=new d({formSubmitHandler:e=>{I.renderLoading(!0),k.changeAvatar({avatar:e.url}).then(e=>{f.setAvatar(e)}).then(()=>{I.close()}).catch(e=>{console.log(e),L(".popup-edit-avatar")}).finally(()=>{I.renderLoading(!1)})}},".popup-edit-avatar");g.setEventListeners(),C.setEventListeners(),I.setEventListeners(),a.addEventListener("click",(function(){y(".popup-edit");const e=document.querySelector(".popup__input_userName"),t=document.querySelector(".popup__input_userDescription"),{name:r,description:s}=p.getUserInfo();e.value=r,t.value=s})),c.addEventListener("click",(function(){y(".popup-add")})),v.addEventListener("click",(function(){y(".popup-edit-avatar")})),L(".popup-edit"),L(".popup-add")}]);